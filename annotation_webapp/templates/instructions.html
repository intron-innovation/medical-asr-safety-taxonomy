{% extends "base.html" %}

{% block title %}Instructions - ASR Annotation Tool{% endblock %}

{% block content %}
<div class="instructions-container">
        <header>
            <h1>üìñ Annotation Instructions & Guide</h1>
            <p>Complete guide to annotating ASR errors in medical conversations</p>
        </header>


    <!-- Table of Contents -->
    <!--<div class="toc">-->
    <!--    <h3>Table of Contents</h3>-->
    <!--    <ul>-->
    <!--        <li><a href="#overview">1. Overview</a></li>-->
    <!--        <li><a href="#taxonomy">2. Error Taxonomy (11 Categories)</a></li>-->
    <!--        <li><a href="#examples">3. Detailed Examples</a></li>-->
    <!--        <li><a href="#workflow">4. Annotation Workflow</a></li>-->
    <!--        <li><a href="#severity">5. Severity Guidelines</a></li>-->
    <!--        <li><a href="#interface">6. Using the Interface</a></li>-->
    <!--        <li><a href="#bestpractices">7. Best Practices</a></li>-->
    <!--        <li><a href="#faq">8. FAQ</a></li>-->
    <!--    </ul>-->
    <!--</div>-->

    <!-- Section 1: Overview -->
    <div class="section" id="overview">
        <h2>1. Overview</h2>
        <p>
            You will annotate safety related errors in ASR (Automatic Speech Recognition) transcripts of medical conversations.
            Each error is tagged with its type (<strong>DEL</strong> = deletion, <strong>SUB</strong> = substitution,
            <strong>INS</strong> = insertion) and displayed in color-coded format.
        </p>
        <p><strong>Your Task:</strong></p>
        <ul class="checklist">
            <li>Click on each highlighted error</li>
            <li>Select ALL applicable taxonomy categories</li>
            <li>Rate the clinical severity (1-3 scale)</li>
            <li>Save to auto-sync to server</li>
        </ul>

    <h2>2. Understanding Error Types</h2>
    <p>ASR errors come in three main types, each color-coded for easy identification:</p>
    <div class="error-types">
        <div class="error-type del">
            <h4>üî¥ DEL (Deletion)</h4>
            <p>ASR missed or deleted words that were in the human transcript</p>
        </div>
        <div class="error-type sub">
            <h4>üü° SUB (Substitution)</h4>
            <p>ASR output wrong word instead of the correct word</p>
        </div>
        <div class="error-type ins">
            <h4>üîµ INS (Insertion)</h4>
            <p>ASR added extra words that weren't in the human transcript</p>
        </div>
    </div>
</div>

    <!-- Section 2: Taxonomy -->
    <div class="section" id="taxonomy">
        <h2>3. Error Taxonomy (9 Categories, including Not an Error)</h2>

        <div class="taxonomy-grid">
            <div class="taxonomy-card">
                <h3>1. Medication</h3>
                <p>Drug names, classes, brand/generic names</p>
                <div class="example">Example: "naproxen" ‚Üí "proxen"</div>
            </div>

            <div class="taxonomy-card">
                <h3>2. Medical Procedure</h3>
                <p>Procedures, imaging, tests, treatments</p>
                <div class="example">Example: "biopsy" ‚Üí "biospeed "</div>
            </div>

            <div class="taxonomy-card">
                <h3>3. Anatomical References</h3>
                <p>Body parts, organs, anatomical landmarks</p>
                <div class="example">Example: "runny nose" ‚Üí "renny knows"</div>
            </div>

            <div class="taxonomy-card">
                <h3>4. Patient Vitals</h3>
                <p>Vital signs and measurements (BP, HR, temperature)</p>
                <div class="example">Example: "120 over 80" ‚Üí "120 over 8"</div>
            </div>

            <div class="taxonomy-card">
                <h3>5. Clinical Signs/Symptoms</h3>
                <p>Symptoms, complaints, clinical findings</p>
                <div class="example">Example: "middle ear effusion" ‚Üí "middle ear fusion"</div>
            </div>

            <div class="taxonomy-card">
                <h3>6. Diagnostic Errors</h3>
                <p>Diagnoses, diagnostic conclusions, test results</p>
                <div class="example">Example: "Quervains tenosynovitis" ‚Üí "quarvains tinosinovitis"</div>
            </div>

            <div class="taxonomy-card">
                <h3>7. Bio Data</h3>
                <p>Patient identifiers and demographics (name, location, sex)</p>
                <div class="example">Example: "Ekiti" ‚Üí "Nkita"</div>
            </div>

            <div class="taxonomy-card">
                <h3>8. Semantics</h3>
                <p>Meaning changes that alter intent or interpretation</p>
                <div class="example">Example: "cigarette pack" ‚Üí "cigarette back"</div>
            </div>

            <div class="taxonomy-card">
                <h3>9. Not an Error</h3>
                <p>Mark when the highlight is not actually an error</p>
                <div class="example">Example: "uh" retained exactly as spoken</div>
            </div>
        </div>
    </div>

    <!-- Section 3: Examples -->
    <div class="section" id="examples">
        <h2>4. Detailed Examples</h2>

        <h3>Multi-Category Errors</h3>
        <div class="example-box">
            <strong>Error:</strong> [SUB:naproxen 500mg->proxen]<br>
            <strong>Categories:</strong> Medication + Semantics<br>
            <strong>Severity:</strong> 2 (Moderate) - Missing dosage changes intent
        </div>

        <div class="example-box">
            <strong>Error:</strong> [SUB:no chest pain->chest pain]<br>
            <strong>Categories:</strong> Clinical Signs/Symptoms + Semantics<br>
            <strong>Severity:</strong> 3 (Severe) - Reverses symptom status
        </div>

        <div class="example-box">
            <strong>Error:</strong> [SUB:120/80->120/8]<br>
            <strong>Context:</strong> "BP is ___"<br>
            <strong>Categories:</strong> Patient Vitals<br>
            <strong>Severity:</strong> 3 (Severe) - Incorrect vital sign
        </div>
    </div>

    <!-- Section 4: Workflow -->
    <div class="section" id="workflow">
        <h2>5. Annotation Workflow</h2>
        <ol class="workflow-steps-vertical">
            <!--<li><strong>Load Data:</strong> Upload your JSON file in the annotation interface</li>-->
            <li><strong>Read:</strong> Review the human transcript (left) to understand context</li>
            <li><strong>Compare:</strong> Review the ASR output (right) with highlighted errors</li>
            <li><strong>Click:</strong> Click on a colored error to open the annotation modal</li>
            <li><strong>Categorize:</strong> Check ALL applicable taxonomy boxes</li>
            <li><strong>Rate:</strong> Set severity slider (0-5)</li>
            <li><strong>Save:</strong> Click "Save Annotation" - auto-syncs to server</li>
            <li><strong>Continue:</strong> Move to next error until conversation is complete</li>
        </ol>
    </div>

    <!-- Section 5: Severity -->
    <div class="section" id="severity">
        <h2>6. Severity Guidelines</h2>
        <div class="severity-scale">
            <div class="severity-level level-1">
                <div class="severity-number">1</div>
                <div class="severity-label">Minor</div>
            </div>
            <div class="severity-level level-2">
                <div class="severity-number">2</div>
                <div class="severity-label">Moderate</div>
            </div>
            <div class="severity-level level-3">
                <div class="severity-number">3</div>
                <div class="severity-label">Severe</div>
            </div>
        </div>

        <h3>Severity Descriptions</h3>
        <ul class="checklist">
            <li><strong>1 (Minor):</strong> Minimal impact, easily inferred (e.g., slight mispronunciation)</li>
            <li><strong>2 (Moderate):</strong> Noticeable impact, context still partly preserved (e.g., missing dosage)</li>
            <li><strong>3 (Severe):</strong> Significant clinical impact or safety concern (e.g., wrong drug or vital sign)</li>
        </ul>
    </div>

    <!-- Section 6: Best Practices -->
    <div class="section" id="bestpractices">
        <h2>7. Best Practices</h2>
        <div class="tip-box">
            <strong>üí° Tips for Accuracy:</strong>
            <ul>
                <li>Review the human transcript carefully.</li>
                <li>Consider clinical context for severity rating</li>
                <li>Check ALL applicable taxonomy categories</li>
                <li>Be consistent in severity scoring</li>
                <li>Take breaks every hour to avoid fatigue</li>
            </ul>
        </div>
        <div class="tip-box">
    <strong>üí° Tip:</strong> 
    <span style="display: inline-block; width: 10px; height: 10px; background: #48bb78; border-radius: 50%; margin: 0 5px; vertical-align: middle;"></span>
    <span style="vertical-align: middle;">Annotated error</span>
    <span style="display: inline-block; width: 10px; height: 10px; background: #ed8936; border-radius: 50%; margin: 0 5px; vertical-align: middle;"></span>
    <span style="vertical-align: middle;">Needs annotation</span>
</div>
    </div>

    <!-- Section 7: FAQ -->
    <div class="section" id="faq">
        <h2>8. FAQ</h2>

        <h3>Q: Can an error have multiple categories?</h3>
        <p><strong>A:</strong> YES! Select all applicable categories. Many errors span multiple dimensions.</p>

        <h3>Q: What if I make a mistake?</h3>
        <p><strong>A:</strong> Click the error again to re-open and modify your annotation.</p>

        <h3>Q: How is my progress saved?</h3>
        <p><strong>A:</strong> Annotations auto-save to the server after each save. Your progress persists across sessions.</p>

        <!--<h3>Q: Can I export my annotations?</h3>-->
        <!--<p><strong>A:</strong> Yes! Use the "Export" button in the annotation interface to download your work.</p>-->
    </div>

    <div class="buttons">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">‚Üê Back to Home</a>
        <a href="{{ url_for('select_model') }}" class="btn btn-primary">Start Annotating ‚Üí</a>
    </div>
</div>
{% endblock %}